locality alice : 1
locality bob : 1

// func f 
//     arity 0

name X<@i> : nonce @ alice<i>
name aad_val<@i> : nonce @ alice<i>
corr<i> adv ==> [aad_val<@i>]
counter N<@i> @ alice<i>
counter M<@i> @ bob<i>
name k<@i> : st_aead Name(X<@i>)
    aad x. (x == get(aad_val<@i>))
    nonce N
    @ alice<i>

struct dummy_struct {
      _dummy_tag : Const(0xdeadbeef)
    , _dummy_val : Data<adv>
}

func get_dummy_tag() = 0xdeadbeef

def alice_main<@i>() @ alice<i> : Unit = 
    inc_counter N<@i>;
    let x = get_counter N<@i> in 
    assert (aad(k<@i>)[get(aad_val<@i>)]);
    let c = st_aead_enc<N<@i>>(get(k<@i>), get(X<@i>), get(aad_val<@i>)) in 
    let hash_something = crh(0xdeadbeef) in
    let dummy_tag = get_dummy_tag() in
    let hash_something_else = crh(0xfeedface) in
    let dummy = dummy_struct(dummy_tag, c) in
    let hash_yet_something_else = crh(0xfeedfacedeadbeef) in
    output dummy to endpoint(alice<i>);
    corr_case k<@i> in
    input h in 
    case st_aead_dec(get(k<@i>), c, h, x) {
     | None => ()
     | Some _y => 
        let y : if sec(k<@i>) then (_:Name(X<@i>){h == get(aad_val<@i>)}) else Data<adv> = _y in
        ()
    }

def bob_main<@i>() @ bob<i> : Unit = ()

    



