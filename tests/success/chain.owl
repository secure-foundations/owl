locality alice

name d : nonce @ alice

nametype enckey_for_d = enckey Name(d)
nametype ck1_t = kdf {ikm info.
    True -> strict enckey_for_d
}

name psk3 : dualkdf {salt info.
    True -> strict enckey_for_d
} @ alice

name psk2 : dualkdf {salt info.
    True -> strict ck1_t
} @ alice

name psk1 : kdf {ikm info.
    True -> strict ck1_t
} @ alice

corr [psk1] /\ [psk2] /\ [psk3] ==> [d]

def main() @ alice : Unit = 
    corr_case psk1 in 
    corr_case psk2 in 
    corr_case psk3 in 
    let ck1 = kdf<0;0;0>(get(psk1), get(psk2), 0x) in
    let k = kdf<0;0;0>(ck1, get(psk3), 0x) in
    let c = aenc(k, get(d)) in 
    output c
    


/*
    ck1 <- kdf(psk1, psk2, "");
    k <- kdf(ck1, psk3, "");
    encrypt(k, data);
*/
